{% extends 'base.html' %}

{% block content %}
<div class="container-fluid">
   {% if messages %}
    <div class="row text-center topspace">
      <div class="col-sm-8 col-sm-offset-2">
        {% for message in messages %}
          <h4 {% if message.tags %} class="{{ message.tags }}"
              {% endif %}>
            {{ message | safe }}
          </h4>
        {% endfor %}
      </div>
    </div>
  {% endif %}
  {% if post.published_date %}
    <div class="row topspace">
      <div class="col-sm-12">
        <div class="entry-header">
          <div class="entry-meta">
            {{ post.published_date }}
          </div>
        </div>
      </div>
    </div>
  {% endif %}
  <div class="row">
    <div class="col-sm-12">
      <div class="entry-title">
        {% if language == "fr" %}
          {{ post.title_fr|safe }}
        {% else %}
          {{ post.title_en|safe }}
        {% endif %}
      </div>
    </div>
  </div>
  {% if post.display_url %}
    <div class="row">
      <div class="col-sm-8 col-sm-offset-2">
        <iframe width="560"
          height="315"
          src="{{ post.url }}"
          frameborder="0"
          allowfullscreen>
        </iframe>
      </div>
    </div>
  {% endif %}
  <div class="row">
    <div class="col-sm-8 col-sm-offset-2">
      {% if language == "fr" %}
          {{ post.text_fr|safe }}
        {% else %}
          {{ post.text_en|safe }}
        {% endif %}
    </div>
  </div>
  <div class="row">
    <div class="col-sm-10 col-sm-offset-1">
      <div class="article-social">
        <script type="IN/Share"
                data-counter="right"
                data-url="{{ request.path }}"></script>
      </div>
      <div class="article-social">
        <a class="twitter-share-button" href="{{ request.path }}">
          Tweet
        </a>
      </div>
      <div class="article-social fb-like"
        data-href="{{ request.path }}"
        data-layout="button_count"
        data-action="like"
        data-size="small"
        data-show-faces="true"
        data-share="true">
      </div>
    </div>
  </div>
  <div class="row section featured topspace">
    <div class="col-xs-10 col-xs-offset-1 form-style-3 text-center signup">
      <h4>
        {% if language == "fr" %}
          Souscrivez à Shumpaga
        {% else %}
          Sign up for Shumpaga's newsletter
        {% endif %}
      </h4>
      <form method="POST">{% csrf_token %}
        <div class="row">
          <div class="col-xs-6 col-xs-offset-3">
            {% for field in subscribe_form %}
              {{ field }}
            {% endfor %}
          </div>
          <div class="col-xs-3">
            <input type="submit" value="
            {% if language == "fr" %}
              Souscrire
            {% else %}
              Subscribe
            {% endif %}" class="btn btn-default">
          </div>
        </div>
      </form>
    </div>
  </div>
  {% load comments %}
  {% load threadedcomments_tags %}
  {% get_comment_count for post as count %}
  <div class="row topspace">
    <div class="col-sm-8 col-sm-offset-2">
      <h3 class="comments-title">
        {% if language == "fr" %}
          Commentaires ({{ count }})
        {% else %}
          Comments ({{ count }})
        {% endif %}
      </h3><br/>
    </div>
  </div>
  <div class="row form-style-3">
    <div class="col-sm-8 col-sm-offset-2">
      <h4>
        {% if language == "fr" %}
          Laissez un commentaire
        {% else %}
          Leave a comment
        {% endif %}
      </h4>
      {% get_comment_form for post as form %}
      <form class="post-form" action="{% comment_form_target %}" method="post">
        {% csrf_token %}
        <fieldset>
          {% for field in form %}
            {% if field.is_hidden %}
                  {{ field }}
            {% else %}
              {% ifequal field.name "name" %}
                <p><label for="id_name">{% if language == "fr" %}Nom:{% else %}Name:{% endif %}</label> {{ field }} </p>
              {% else %}{% ifequal field.name "comment" %}
                <p><label for="id_comment">{% if language == "fr" %}Commentaire:{% else %}Comment:{% endif %}</label> {{ field }} </p>
              {% else %}
              {% endifequal %}{% endifequal %}
            {% endif %}
          {% endfor %}
          <input type="submit" name="submit" value="{% if language == "fr" %}Approuver{% else %}Post comment{% endif %}" class="tn btn-default">
          <input type="hidden" name="next" value="{{ request.path }}" />
        </fieldset>
      </form>
    </div>
  </div>
  {% get_comment_list for post as comment_list %}
  {% load common %}
  <div class="row" id="comments">
    <div class="col-sm-10 col-sm-offset-1">
      <ol class="comments">
        {% for comment in comment_list %}
          {% if not comment.parent_id %} <hr> {% endif %}
          <li class="{% if comment.parent_id %}comment-child{% else %}comment{% endif %}">
            <div class="row">
              <div class="col-sm-10">
                <div class="comment-body {% if comment.parent_id %}reply{% endif %}">
                  <div class="text">
                    <p>{{ comment.comment }}</p>
                  </div>
                  <div class="attribution">
                    {% if language == "fr" %}par {% else %}by {% endif %}<span class="author"> {{ comment.user_name }}  </span>
                    {% if language == "fr" %}à {% else %}at {% endif %}<span class="date"> {% if language == "fr" %}{{ comment.submit_date | date:'H:i, d-m-Y' }}{% else %}{{ comment.submit_date |date:'H:i a m-d-Y'}}{% endif %}</span>
                  </div>
                </div>
              </div>
              <div class="col-sm-2 pull-right">
                <button class="comment-reply push_button" onclick="myFunction('showHide{{ comment.id }}')">{% if language == "fr" %}Répondre{% else %}Reply{% endif %}</button>
              </div>
            </div>
            <div class="form-style-3 subform" id="showHide{{comment.id}}">
              {% get_comment_form for post as form with comment.id %}
              <form class="post-form" action="{% comment_form_target %}" method="post">
                {% csrf_token %}
                <fieldset>
                  {% for field in form %}
                    {% if field.is_hidden %}
                          {{ field }}
                    {% else %}
                      {% ifequal field.name "name" %}
                        <p><label for="id_name">{% if language == "fr" %}Nom:{% else %}Name:{% endif %}</label> {{ field }} </p>
                      {% else %}{% ifequal field.name "comment" %}
                        <p><label for="id_comment">{% if language == "fr" %}Commentaire:{% else %}Comment:{% endif %}</label> {{ field }} </p>
                      {% else %}
                      {% endifequal %}{% endifequal %}
                    {% endif %}
                  {% endfor %}
                  <input type="submit" name="submit" value="{% if language == "fr" %}Approuver{% else %}Post comment{% endif %}" class="tn btn-default">
                  <input type="hidden" name="next" value="{{ request.path }}" />
                </fieldset>
              </form>
            </div>
          </li>
        {% endfor %}
      </ol>
    </div>
  </div>
  <script language="javascript">
    function myFunction(showHideid) {
      var x = document.getElementById(showHideid);
      if (x.style.display === "block") {
        x.style.display = "none";
      } else {
        x.style.display = "block";
      }
    }
  </script>
</div>
{% endblock %}
